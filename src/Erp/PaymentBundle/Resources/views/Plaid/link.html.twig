<script src="https://cdn.plaid.com/link/v2/stable/link-initialize.js"></script>
<script>
    var linkHandler = Plaid.create({
        env: '{{ plaid_env }}',
        clientName: 'Erentpay',
        key: '{{ plaid_public_key }}',
        product: ['auth'],
        selectAccount: true,
        onSuccess: function(public_token, metadata) {
            $.ajax({
                url: '{{ path("erp_payment_stripe_verify_bank_account") }}',
                type: 'POST',
                data: {
                    publicToken: public_token,
                    accountId: metadata.account_id
                },
                success: function (response) {
                    if (response.success) {
                        window.location = '{{ path("erp_payment_unit_buy") }}';
                    }
                }
            });
        },
        onExit: function(err, metadata) {
            if (err != null) {

            }
        }
    });

    document.getElementById('verify-ba').onclick = function() {
        linkHandler.open();
    };
</script>